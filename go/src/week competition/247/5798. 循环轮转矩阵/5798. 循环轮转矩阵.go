package main

import "fmt"

func rotateGrid(grid [][]int, k int) [][]int {
	m, n := len(grid), len(grid[0])
	for r1, c1, r2, c2 := 0, 0, m-1, n-1; r1 < r2 && c1 < c2; r1, c1, r2, c2 = r1+1, c1+1, r2-1, c2-1 {
		rotate(r1, c1, r2, c2, grid, k)
	}
	fmt.Println(grid)
	return grid
}

func rotate(r1, c1, r2, c2 int, grid [][]int, k int) {
	var s = (c2 - c1 + 1) * 2 + (r2 - r1 - 1)*2
	k %= s
	if k == 0 {
		return
	}
	a := []int{}
	i, j := r1, c1
	for ; i <= r2; i++ {
		a = append(a, grid[i][j])
	}
	i--
	j++
	for ; j <= c2; j++ {
		a = append(a, grid[i][j])
	}
	j--
	i--
	for ; i >= r1; i-- {
		a = append(a, grid[i][j])
	}
	i++
	j--
	for ; j > c1; j-- {
		a = append(a, grid[i][j])
	}

	// ------------
	k = s - k

	i, j = r1, c1
	for ; i <= r2; i++ {
		grid[i][j] = a[k]
		k = (k+1)%s
	}
	i--
	j++
	for ; j <= c2; j++ {
		grid[i][j] = a[k]
		k = (k+1)%s
	}
	j--
	i--
	for ; i >= r1; i-- {
		grid[i][j] = a[k]
		k = (k+1)%s
	}
	i++
	j--
	for ; j > c1; j-- {
		grid[i][j] = a[k]
		k = (k+1)%s
	}
}

func main() {
	//rotateGrid([][]int{{1,2,3,4},{5,6,7,8},{9,10,11,12},{13,14,15,16}}, 2)
	//rotateGrid([][]int{{40,10},{30,20}}, 1)
	rotateGrid([][]int{{386,2615,3563,3035,475,3444,729,1583,2866,1550,1186,704,1729,2864,2614,4837,4373,4225,4352,3820,358,4104,1016,1441,1907,674,2256,2441},{4736,1231,2739,3967,653,57,270,814,2173,2363,616,1619,4910,4770,2530,2741,2365,4659,4395,3047,127,4963,3414,4928,3373,339,4367,2925},{81,2738,304,4520,2061,172,3348,4773,503,1583,1285,3832,103,2693,1174,741,2459,1007,28,3718,3414,2036,1965,778,2183,1761,4830,1329},{3622,3304,1915,50,610,2357,1646,3948,3466,3408,4083,3824,2545,4915,2632,1240,2417,4208,2247,2846,1443,2567,1479,4901,3249,619,1447,3335},{2331,81,4906,50,1802,4856,2284,4087,355,4972,271,2178,3028,4392,1499,3564,1848,909,1572,129,1950,1546,300,3769,3789,4548,882,1193},{2122,4654,218,4630,741,1972,820,3477,4823,1547,1764,2448,4099,2217,3914,434,3922,3619,4132,4731,373,3197,1997,2317,2270,482,4922,928},{895,94,3365,1878,3168,149,180,1789,1779,4570,1643,2472,3202,455,2411,2461,584,2229,2030,3902,4938,3859,2196,1123,4843,4368,4657,873},{2383,3483,236,4925,4605,2869,1707,232,2174,3762,621,1791,2726,673,4721,905,208,3535,1146,726,3811,4680,157,2565,823,4707,3425,4534},{3097,196,3162,262,4863,4110,2601,2642,1693,403,3875,3983,1791,3608,4092,894,4808,26,610,2019,3321,3596,3189,1685,4755,3273,4286,3679},{1721,3223,585,715,124,3337,2000,2216,2551,3415,1489,2616,1673,2115,2413,2995,3866,932,3444,1942,2223,1146,4428,216,2106,4311,3472,721},{4061,2672,707,4023,1242,1430,2396,4515,214,1061,4998,4264,2589,704,2671,3783,1148,46,4899,1059,925,3754,3443,2324,4419,3426,4808,475},{1893,878,875,1605,906,3288,2329,3018,1893,4713,4858,4352,2631,3018,108,3064,1131,860,2415,2188,3933,2779,3185,2412,62,2555,1546,3237},{2630,4836,4533,2613,156,1934,364,4208,4424,1455,4065,4990,3230,4331,1986,3877,1240,2399,194,4554,1353,1141,2461,2051,3515,1552,4341,3788},{868,4511,996,3258,3147,2480,2716,1437,1416,3641,1016,3479,2831,4060,512,372,1765,567,2806,1949,389,4837,4453,3922,836,1109,694,4194},{3739,328,4706,4456,4654,4882,2658,4833,344,4385,1952,3671,4707,4977,3067,2178,4515,2199,826,2894,3745,2547,3660,3522,4435,3266,4469,2249},{1604,283,4104,2772,1448,3087,1277,3578,3774,3297,3239,4848,1982,3255,1129,64,4781,2495,2883,4886,237,4951,2128,3344,2565,964,871,549},{954,185,3016,3074,4083,1804,3842,550,131,4086,4497,518,415,4934,1067,1767,2933,1360,2527,838,4647,4980,4079,4570,4756,3567,4438,4967},{509,4994,467,2886,2344,2222,2602,4397,1127,1583,2799,1697,4780,3311,1167,4355,4614,2710,4258,1213,43,63,405,1968,3351,4198,2482,4379},{4281,4046,2585,4015,4262,4410,69,806,2302,4005,3939,2058,956,4527,1249,3881,2652,4682,1770,2476,1381,1537,187,4927,3583,3146,4596,3527},{1309,299,3176,3563,1107,747,3103,1343,1205,927,1040,3383,3073,1234,266,4646,3018,4748,4519,4110,3877,1941,3353,1438,3139,605,3687,3592},{4979,4830,4294,3923,1814,4906,566,4355,1242,1935,1408,4533,3635,4165,4378,2712,2050,4176,4219,224,63,4925,338,4118,2440,4792,4190,4156},{2600,2092,4955,2593,3419,2478,4622,2785,2711,3257,3466,728,705,3958,1975,424,1519,1056,2558,1588,646,1814,2472,3008,877,2067,2805,698}}, 657206608)
}
