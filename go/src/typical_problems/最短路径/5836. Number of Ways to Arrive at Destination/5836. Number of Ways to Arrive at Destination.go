package main

import (
	"fmt"
	"math"
)

/**
https://leetcode-cn.com/problems/number-of-ways-to-arrive-at-destination/

思路：最短路径 + 动态规划
1. 求出0到剩余节点的最短路径
2. 由0到n-1的最短路径必然位于0到u、u到n-1的最短路径上，也就是说0到其余节点的最短路径构成的有向无环图上(DAG)
f[i]表示i 到 n-1的最短路径数目，
f[i] = sum(f[j]), i->j
特别的,f[n-1] = 1
答案为f[0]
 */
var mod = int(math.Pow10(9)) + 7

func countPaths(n int, roads [][]int) int {
	grid := make([][]int64, n)
	for i := range grid {
		grid[i] = make([]int64, n)
		for j := range grid[i] {
			grid[i][j] = math.MaxInt64 >> 1		// 初始化为MaxInt64/2, 防止溢出
		}
		grid[i][i] = 0
	}
	for _, road := range roads {
		u, v, t := road[0], road[1], int64(road[2])
		grid[u][v] = t
		grid[v][u] = t
	}
	vis := make([]bool, n)
	vis[0] = true
	dis := make([]int64, n)
	for i := range dis {
		dis[i] = grid[0][i]
	}

	for h := 0; h < n; h++ {
		minIdx := -1
		minDis := int64(math.MaxInt64)
		for i := range dis {
			if !vis[i] && dis[i] < minDis {
				minDis = dis[i]
				minIdx = i
			}
		}
		if minIdx == -1 {
			continue
		}
		vis[minIdx] = true
		for i := 0; i < n; i++ {
			if dis[minIdx] + grid[minIdx][i] < dis[i] {
				dis[i] = dis[minIdx] + grid[minIdx][i]
				//if dis[i] >= mod {
				//	dis[i] -= mod
				//}
			}
		}
	}

	//fmt.Println(dis)

	g := make([][]int, n)	// 由最短路径构造的DAG
	for i := range g {
		g[i] = []int{}
	}

	for _, road := range roads {
		u, v, t := road[0], road[1], int64(road[2])
		if t == dis[v] - dis[u] {
			g[u] = append(g[u], v)
		} else if t == dis[u] - dis[v] {
			g[v] = append(g[v], u)
		}
	}

	f := make([]int, n)
	for i := range f {
		f[i] = -1
	}
	f[n-1] = 1

	var dfs func(int) int
	dfs = func(i int) int {
		if f[i] != -1 {
			return f[i]
		}

		f[i] = 0
		for _, j := range g[i] {
			f[i] += dfs(j)
			if f[i] >= mod {
				f[i] -= mod
			}
		}
		return f[i]
	}

	dfs(0)
	//fmt.Println(f)
	fmt.Println(f[0])
	return f[0]
}

func main() {
	//countPaths(7, [][]int{{0,6,7},{0,1,2},{1,2,3},{1,3,3},{6,3,3},{3,5,1},{6,5,1},{2,5,1},{0,4,5},{4,6,2}})
	//countPaths(2, [][]int{{1,0,10}})
	countPaths(200, [][]int{{0,1,1000000000},{1,2,1000000000},{2,3,1000000000},{3,4,1000000000},{4,5,1000000000},{5,6,1000000000},{6,7,1000000000},{7,8,1000000000},{8,9,1000000000},{9,10,1000000000},{10,11,1000000000},{11,12,1000000000},{12,13,1000000000},{13,14,1000000000},{14,15,1000000000},{15,16,1000000000},{16,17,1000000000},{17,18,1000000000},{18,19,1000000000},{19,20,1000000000},{20,21,1000000000},{21,22,1000000000},{22,23,1000000000},{23,24,1000000000},{24,25,1000000000},{25,26,1000000000},{26,27,1000000000},{27,28,1000000000},{28,29,1000000000},{29,30,1000000000},{30,31,1000000000},{31,32,1000000000},{32,33,1000000000},{33,34,1000000000},{34,35,1000000000},{35,36,1000000000},{36,37,1000000000},{37,38,1000000000},{38,39,1000000000},{39,40,1000000000},{40,41,1000000000},{41,42,1000000000},{42,43,1000000000},{43,44,1000000000},{44,45,1000000000},{45,46,1000000000},{46,47,1000000000},{47,48,1000000000},{48,49,1000000000},{49,50,1000000000},{50,51,1000000000},{51,52,1000000000},{52,53,1000000000},{53,54,1000000000},{54,55,1000000000},{55,56,1000000000},{56,57,1000000000},{57,58,1000000000},{58,59,1000000000},{59,60,1000000000},{60,61,1000000000},{61,62,1000000000},{62,63,1000000000},{63,64,1000000000},{64,65,1000000000},{65,66,1000000000},{66,67,1000000000},{67,68,1000000000},{68,69,1000000000},{69,70,1000000000},{70,71,1000000000},{71,72,1000000000},{72,73,1000000000},{73,74,1000000000},{74,75,1000000000},{75,76,1000000000},{76,77,1000000000},{77,78,1000000000},{78,79,1000000000},{79,80,1000000000},{80,81,1000000000},{81,82,1000000000},{82,83,1000000000},{83,84,1000000000},{84,85,1000000000},{85,86,1000000000},{86,87,1000000000},{87,88,1000000000},{88,89,1000000000},{89,90,1000000000},{90,91,1000000000},{91,92,1000000000},{92,93,1000000000},{93,94,1000000000},{94,95,1000000000},{95,96,1000000000},{96,97,1000000000},{97,98,1000000000},{98,99,1000000000},{99,100,1000000000},{100,101,1000000000},{101,102,1000000000},{102,103,1000000000},{103,104,1000000000},{104,105,1000000000},{105,106,1000000000},{106,107,1000000000},{107,108,1000000000},{108,109,1000000000},{109,110,1000000000},{110,111,1000000000},{111,112,1000000000},{112,113,1000000000},{113,114,1000000000},{114,115,1000000000},{115,116,1000000000},{116,117,1000000000},{117,118,1000000000},{118,119,1000000000},{119,120,1000000000},{120,121,1000000000},{121,122,1000000000},{122,123,1000000000},{123,124,1000000000},{124,125,1000000000},{125,126,1000000000},{126,127,1000000000},{127,128,1000000000},{128,129,1000000000},{129,130,1000000000},{130,131,1000000000},{131,132,1000000000},{132,133,1000000000},{133,134,1000000000},{134,135,1000000000},{135,136,1000000000},{136,137,1000000000},{137,138,1000000000},{138,139,1000000000},{139,140,1000000000},{140,141,1000000000},{141,142,1000000000},{142,143,1000000000},{143,144,1000000000},{144,145,1000000000},{145,146,1000000000},{146,147,1000000000},{147,148,1000000000},{148,149,1000000000},{149,150,1000000000},{150,151,1000000000},{151,152,1000000000},{152,153,1000000000},{153,154,1000000000},{154,155,1000000000},{155,156,1000000000},{156,157,1000000000},{157,158,1000000000},{158,159,1000000000},{159,160,1000000000},{160,161,1000000000},{161,162,1000000000},{162,163,1000000000},{163,164,1000000000},{164,165,1000000000},{165,166,1000000000},{166,167,1000000000},{167,168,1000000000},{168,169,1000000000},{169,170,1000000000},{170,171,1000000000},{171,172,1000000000},{172,173,1000000000},{173,174,1000000000},{174,175,1000000000},{175,176,1000000000},{176,177,1000000000},{177,178,1000000000},{178,179,1000000000},{179,180,1000000000},{180,181,1000000000},{181,182,1000000000},{182,183,1000000000},{183,184,1000000000},{184,185,1000000000},{185,186,1000000000},{186,187,1000000000},{187,188,1000000000},{188,189,1000000000},{189,190,1000000000},{190,191,1000000000},{191,192,1000000000},{192,193,1000000000},{193,194,1000000000},{194,195,1000000000},{195,196,1000000000},{196,197,1000000000},{197,198,1000000000},{198,199,1000000000}})
	countPaths(200, [][]int{{0,1,865326231},{1,4,865326231},{0,2,865326231},{2,4,865326231},{0,3,865326231},{3,4,865326231},{4,5,647618270},{5,9,647618270},{4,6,647618270},{6,9,647618270},{4,7,647618270},{7,9,647618270},{4,8,647618270},{8,9,647618270},{9,10,153310768},{10,15,153310768},{9,11,153310768},{11,15,153310768},{9,12,153310768},{12,15,153310768},{9,13,153310768},{13,15,153310768},{9,14,153310768},{14,15,153310768},{15,16,446216658},{16,21,446216658},{15,17,446216658},{17,21,446216658},{15,18,446216658},{18,21,446216658},{15,19,446216658},{19,21,446216658},{15,20,446216658},{20,21,446216658},{21,22,482432125},{22,27,482432125},{21,23,482432125},{23,27,482432125},{21,24,482432125},{24,27,482432125},{21,25,482432125},{25,27,482432125},{21,26,482432125},{26,27,482432125},{27,28,546917635},{28,32,546917635},{27,29,546917635},{29,32,546917635},{27,30,546917635},{30,32,546917635},{27,31,546917635},{31,32,546917635},{32,33,905837683},{33,37,905837683},{32,34,905837683},{34,37,905837683},{32,35,905837683},{35,37,905837683},{32,36,905837683},{36,37,905837683},{37,38,941383964},{38,41,941383964},{37,39,941383964},{39,41,941383964},{37,40,941383964},{40,41,941383964},{41,42,482278242},{42,44,482278242},{41,43,482278242},{43,44,482278242},{44,45,209029963},{45,49,209029963},{44,46,209029963},{46,49,209029963},{44,47,209029963},{47,49,209029963},{44,48,209029963},{48,49,209029963},{49,50,180362920},{50,53,180362920},{49,51,180362920},{51,53,180362920},{49,52,180362920},{52,53,180362920},{53,54,40040617},{54,58,40040617},{53,55,40040617},{55,58,40040617},{53,56,40040617},{56,58,40040617},{53,57,40040617},{57,58,40040617},{58,59,429647103},{59,62,429647103},{58,60,429647103},{60,62,429647103},{58,61,429647103},{61,62,429647103},{62,63,863858638},{63,64,250353988},{64,66,250353988},{63,65,250353988},{65,66,250353988},{66,67,502785687},{67,68,565934645},{68,69,548158326},{69,74,548158326},{68,70,548158326},{70,74,548158326},{68,71,548158326},{71,74,548158326},{68,72,548158326},{72,74,548158326},{68,73,548158326},{73,74,548158326},{74,75,858926247},{75,79,858926247},{74,76,858926247},{76,79,858926247},{74,77,858926247},{77,79,858926247},{74,78,858926247},{78,79,858926247},{79,80,610164528},{80,82,610164528},{79,81,610164528},{81,82,610164528},{82,83,116910438},{83,84,153203278},{84,88,153203278},{83,85,153203278},{85,88,153203278},{83,86,153203278},{86,88,153203278},{83,87,153203278},{87,88,153203278},{88,89,484666281},{89,93,484666281},{88,90,484666281},{90,93,484666281},{88,91,484666281},{91,93,484666281},{88,92,484666281},{92,93,484666281},{93,94,694001013},{94,95,180373702},{95,96,392438425},{96,97,392438425},{97,98,915720722},{98,99,915720722},{99,100,660886218},{100,101,980566840},{101,103,980566840},{100,102,980566840},{102,103,980566840},{103,104,509703517},{104,105,817920401},{105,106,992341639},{106,107,992341639},{107,108,180854348},{108,111,180854348},{107,109,180854348},{109,111,180854348},{107,110,180854348},{110,111,180854348},{111,112,699029750},{112,115,699029750},{111,113,699029750},{113,115,699029750},{111,114,699029750},{114,115,699029750},{115,116,973634138},{116,120,973634138},{115,117,973634138},{117,120,973634138},{115,118,973634138},{118,120,973634138},{115,119,973634138},{119,120,973634138},{120,121,785570880},{121,125,785570880},{120,122,785570880},{122,125,785570880},{120,123,785570880},{123,125,785570880},{120,124,785570880},{124,125,785570880},{125,126,720521316},{126,130,720521316},{125,127,720521316},{127,130,720521316},{125,128,720521316},{128,130,720521316},{125,129,720521316},{129,130,720521316},{130,131,829375409},{131,132,152165056},{132,133,152165056},{133,134,50370340},{134,137,50370340},{133,135,50370340},{135,137,50370340},{133,136,50370340},{136,137,50370340},{137,138,704034877},{138,139,484468238},{139,143,484468238},{138,140,484468238},{140,143,484468238},{138,141,484468238},{141,143,484468238},{138,142,484468238},{142,143,484468238},{143,144,205433987},{144,145,205433987},{145,146,166956493},{146,149,166956493},{145,147,166956493},{147,149,166956493},{145,148,166956493},{148,149,166956493},{149,150,476307189},{150,151,388217973},{151,152,388217973},{152,153,211490211},{153,155,211490211},{152,154,211490211},{154,155,211490211},{155,156,186981143},{156,160,186981143},{155,157,186981143},{157,160,186981143},{155,158,186981143},{158,160,186981143},{155,159,186981143},{159,160,186981143},{160,161,305206923},{161,166,305206923},{160,162,305206923},{162,166,305206923},{160,163,305206923},{163,166,305206923},{160,164,305206923},{164,166,305206923},{160,165,305206923},{165,166,305206923},{166,167,482432170},{167,171,482432170},{166,168,482432170},{168,171,482432170},{166,169,482432170},{169,171,482432170},{166,170,482432170},{170,171,482432170},{171,172,455923183},{172,177,455923183},{171,173,455923183},{173,177,455923183},{171,174,455923183},{174,177,455923183},{171,175,455923183},{175,177,455923183},{171,176,455923183},{176,177,455923183},{177,178,266584262},{178,179,266584262},{179,180,751579148},{180,185,751579148},{179,181,751579148},{181,185,751579148},{179,182,751579148},{182,185,751579148},{179,183,751579148},{183,185,751579148},{179,184,751579148},{184,185,751579148},{185,186,389984057},{186,188,389984057},{185,187,389984057},{187,188,389984057},{188,189,926312609},{189,192,926312609},{188,190,926312609},{190,192,926312609},{188,191,926312609},{191,192,926312609},{192,193,323360653},{193,196,323360653},{192,194,323360653},{194,196,323360653},{192,195,323360653},{195,196,323360653},{196,197,977934872},{197,198,977934872},{198,199,434009290}})
	//fmt.Println(equal(-7, 1000000000))
}
